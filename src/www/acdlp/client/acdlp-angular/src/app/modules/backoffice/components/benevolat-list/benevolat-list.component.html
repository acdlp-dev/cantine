<!-- Contenu principal -->
<div class="max-w-7xl mx-auto p-4 sm:p-6">
  <!-- En-tête avec bouton d'export -->
  <div class="max-w-7xl mx-auto p-4 sm:p-6 mt-8">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight flex flex-wrap items-baseline gap-2">
        Liste des <span class="text-[#ff7443]">bénévoles</span>
      </h1>
    </div>

    <div class="flex space-x-2">
      <button (click)="exporterCSV()" [disabled]="benevoles.length === 0"
        class="flex items-center gap-2 bg-white px-4 py-2.5 rounded-lg text-sm text-gray-700 border border-gray-200 hover:border-[#ff7443] hover:bg-[#fff8f6] transition-all shadow-sm hover:shadow disabled:opacity-50 disabled:cursor-not-allowed">
        <i-lucide name="file-text" class="w-4 h-4 text-[#ff7443]"></i-lucide>
        <span>Exporter en CSV</span>
      </button>
  </div>
</div>

<!-- Modal détails bénévole -->
<div *ngIf="showModal" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <!-- Overlay -->
  <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" (click)="closeModal()"></div>

  <!-- Modal -->
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="relative bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="bg-gradient-to-r from-[#ff7443] to-[#ff6234] px-6 py-4 flex justify-between items-center">
        <h3 class="text-xl font-bold text-white flex items-center gap-2">
          <i-lucide name="user" class="w-6 h-6"></i-lucide>
          Détails du bénévole
        </h3>
        <button (click)="closeModal()" class="text-white hover:text-gray-200 transition-colors">
          <i-lucide name="x" class="w-6 h-6"></i-lucide>
        </button>
      </div>

      <!-- Body -->
      <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
        <div *ngIf="selectedBenevole" class="space-y-6">
          <!-- Informations personnelles -->
          <div>
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                <i-lucide name="id-card" class="w-5 h-5 text-[#ff7443]"></i-lucide>
                Informations personnelles
              </h4>
              <button *ngIf="!isEditingBenevole" (click)="startEditBenevole()"
                class="flex items-center gap-2 px-4 py-2 bg-[#ff7443] text-white rounded-lg hover:bg-[#ff6234] transition-colors">
                <i-lucide name="pencil" class="w-4 h-4"></i-lucide>
                <span>Modifier</span>
              </button>
            </div>

            <!-- Mode lecture -->
            <div *ngIf="!isEditingBenevole" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 rounded-lg p-4">
              <div>
                <p class="text-sm text-gray-500">Type</p>
                <p class="font-medium text-gray-900">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-blue-100 text-blue-800': selectedBenevole.type === 'bénévole',
                      'bg-purple-100 text-purple-800': selectedBenevole.type === 'responsable'
                    }">
                    {{ selectedBenevole.type }}
                  </span>
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Statut</p>
                <p class="font-medium text-gray-900">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-green-100 text-green-800': selectedBenevole.statut === 'confirmé',
                      'bg-orange-100 text-orange-800': selectedBenevole.statut === 'restreint',
                      'bg-yellow-100 text-yellow-800': selectedBenevole.statut === 'email en attente'
                    }">
                    {{ selectedBenevole.statut || 'Non renseigné' }}
                  </span>
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Nom complet</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.nom }} {{ selectedBenevole.prenom }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Email</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.email }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Téléphone</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.telephone || 'Non renseigné' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Adresse</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.adresse || 'Non renseignée' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Ville</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.code_postal }} {{ selectedBenevole.ville }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Pays</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.pays }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Âge / Genre</p>
                <p class="font-medium text-gray-900 capitalize">{{ selectedBenevole.age }} ans / {{ selectedBenevole.genre }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Date d'inscription</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.created_at ? (selectedBenevole.created_at | date: 'dd/MM/yyyy') : 'Non renseignée' }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Dernière présence</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.date_derniere_action_presente ? (selectedBenevole.date_derniere_action_presente | date: 'dd/MM/yyyy') : 'Aucune action' }}</p>
              </div>
              <div *ngIf="selectedBenevole.metiers_competences" class="md:col-span-2">
                <p class="text-sm text-gray-500">Métiers / Compétences</p>
                <p class="font-medium text-gray-900">{{ selectedBenevole.metiers_competences }}</p>
              </div>
            </div>

            <!-- Mode édition -->
            <div *ngIf="isEditingBenevole && editedBenevole" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border border-gray-200 rounded-lg p-4">
              <!-- Type -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Type *</label>
                <select [(ngModel)]="editedBenevole.type" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]">
                  <option value="bénévole">Bénévole</option>
                  <option value="responsable">Responsable</option>
                </select>
              </div>

              <!-- Statut -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Statut</label>
                <select [(ngModel)]="editedBenevole.statut" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]">
                  <option value="email en attente">Email en attente</option>
                  <option value="restreint">Restreint</option>
                  <option value="confirmé">Confirmé</option>
                </select>
              </div>

              <!-- Nom -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Nom *</label>
                <input type="text" [(ngModel)]="editedBenevole.nom" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Nom" />
              </div>

              <!-- Prénom -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Prénom *</label>
                <input type="text" [(ngModel)]="editedBenevole.prenom" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Prénom" />
              </div>

              <!-- Email (readonly) -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" [value]="editedBenevole.email" readonly
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"
                  title="L'email ne peut pas être modifié" />
              </div>

              <!-- Téléphone -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                <input type="tel" [(ngModel)]="editedBenevole.telephone" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Téléphone" />
              </div>

              <!-- Adresse -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Adresse</label>
                <input type="text" [(ngModel)]="editedBenevole.adresse" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Adresse" />
              </div>

              <!-- Code postal -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Code postal</label>
                <input type="text" [(ngModel)]="editedBenevole.code_postal" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Code postal" />
              </div>

              <!-- Ville -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                <input type="text" [(ngModel)]="editedBenevole.ville" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Ville" />
              </div>

              <!-- Pays -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Pays</label>
                <input type="text" [(ngModel)]="editedBenevole.pays" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Pays" />
              </div>

              <!-- Âge -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Âge</label>
                <input type="number" [(ngModel)]="editedBenevole.age" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Âge" min="0" max="120" />
              </div>

              <!-- Genre -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Genre</label>
                <select [(ngModel)]="editedBenevole.genre" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]">
                  <option value="homme">Homme</option>
                  <option value="femme">Femme</option>
                  <option value="autre">Autre</option>
                </select>
              </div>

              <!-- Métiers / Compétences -->
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Métiers / Compétences</label>
                <textarea [(ngModel)]="editedBenevole.metiers_competences" rows="3"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443]"
                  placeholder="Métiers ou compétences du bénévole..."></textarea>
              </div>

              <!-- Boutons d'action -->
              <div class="md:col-span-2 flex justify-end gap-3 pt-4 border-t border-gray-200">
                <button (click)="cancelEditBenevole()" [disabled]="isSavingBenevole"
                  class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50">
                  Annuler
                </button>
                <button (click)="saveBenevole()" [disabled]="isSavingBenevole"
                  class="px-4 py-2 bg-[#ff7443] text-white rounded-lg hover:bg-[#ff6234] transition-colors disabled:opacity-50 flex items-center gap-2">
                  <span *ngIf="isSavingBenevole" class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></span>
                  <span>{{ isSavingBenevole ? 'Enregistrement...' : 'Enregistrer' }}</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Loader -->
          <div *ngIf="isLoadingActions" class="flex justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-4 border-[#ff7443]/20 border-t-[#ff7443]"></div>
          </div>

          <!-- Actions futures -->
          <div *ngIf="!isLoadingActions">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <i-lucide name="calendar-plus" class="w-5 h-5 text-green-600"></i-lucide>
              Actions à venir ({{ benevoleActionsFuture.length }})
            </h4>

            <!-- Liste vide -->
            <div *ngIf="benevoleActionsFuture.length === 0" class="text-center py-6 bg-green-50 rounded-lg mb-6">
              <i-lucide name="calendar-plus" class="w-10 h-10 text-green-400 mx-auto mb-2"></i-lucide>
              <p class="text-gray-500">Aucune action future</p>
            </div>

            <!-- Liste des actions futures -->
            <div *ngIf="benevoleActionsFuture.length > 0" class="space-y-3 max-h-80 overflow-y-auto mb-6">
              <div *ngFor="let action of benevoleActionsFuture" 
                class="bg-green-50 border border-green-200 rounded-lg p-4 hover:border-green-400 transition-colors">
                <div class="flex justify-between items-start mb-2">
                  <h5 class="font-semibold text-gray-900">{{ action.action_nom }}</h5>
                  <span class="text-sm text-green-700 font-medium">{{ action.date_action | date: 'dd/MM/yyyy' }}</span>
                </div>
                <div class="space-y-1 text-sm text-gray-600">
                  <p *ngIf="action.ville">
                    <i-lucide name="map-pin" class="w-4 h-4 inline mr-1"></i-lucide>
                    {{ action.rue ? action.rue + ', ' : '' }}{{ action.ville }}
                  </p>
                  <p>
                    <i-lucide name="calendar" class="w-4 h-4 inline mr-1"></i-lucide>
                    {{ action.heure_debut }} - {{ action.heure_fin }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions passées -->
          <div *ngIf="!isLoadingActions">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <i-lucide name="calendar-check" class="w-5 h-5 text-[#ff7443]"></i-lucide>
              Actions effectuées ({{ benevoleActionsPast.length }})
            </h4>

            <!-- Liste vide -->
            <div *ngIf="benevoleActionsPast.length === 0" class="text-center py-6 bg-gray-50 rounded-lg">
              <i-lucide name="calendar" class="w-10 h-10 text-gray-400 mx-auto mb-2"></i-lucide>
              <p class="text-gray-500">Aucune action effectuée pour le moment</p>
            </div>

            <!-- Liste des actions passées -->
            <div *ngIf="benevoleActionsPast.length > 0" class="space-y-3 max-h-80 overflow-y-auto">
              <div *ngFor="let action of benevoleActionsPast" 
                class="bg-white border border-gray-200 rounded-lg p-4 hover:border-[#ff7443] transition-colors">
                <div class="flex justify-between items-start mb-2">
                  <h5 class="font-semibold text-gray-900">{{ action.action_nom }}</h5>
                  <span class="text-sm text-gray-500">{{ action.date_action | date: 'dd/MM/yyyy' }}</span>
                </div>
                <div class="space-y-1 text-sm text-gray-600">
                  <p *ngIf="action.ville">
                    <i-lucide name="map-pin" class="w-4 h-4 inline mr-1"></i-lucide>
                    {{ action.rue ? action.rue + ', ' : '' }}{{ action.ville }}
                  </p>
                  <p>
                    <i-lucide name="calendar" class="w-4 h-4 inline mr-1"></i-lucide>
                    {{ action.heure_debut }} - {{ action.heure_fin }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="bg-gray-50 px-6 py-4 flex justify-end">
        <button (click)="closeModal()" 
          class="px-6 py-2 bg-white text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- Filtres et recherche -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 mb-6">
    <div class="flex flex-wrap gap-6 items-end">
      <!-- Filtre par Type -->
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-600 mb-2">Type</label>
        <div class="relative">
          <select [(ngModel)]="filterType" (change)="onFilterChange()"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-lg pl-4 pr-10 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors">
            <option value="tous">Tous</option>
            <option value="bénévole">Bénévole</option>
            <option value="responsable">Responsable</option>
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3">
            <i-lucide name="chevron-down" class="w-4 h-4 text-gray-500"></i-lucide>
          </div>
        </div>
      </div>

      <!-- Filtre par Genre -->
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-600 mb-2">Genre</label>
        <div class="relative">
          <select [(ngModel)]="filterGenre" (change)="onFilterChange()"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-lg pl-4 pr-10 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors">
            <option value="tous">Tous</option>
            <option value="homme">Homme</option>
            <option value="femme">Femme</option>
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3">
            <i-lucide name="chevron-down" class="w-4 h-4 text-gray-500"></i-lucide>
          </div>
        </div>
      </div>

      <!-- Filtre par Statut -->
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-600 mb-2">Statut</label>
        <div class="relative">
          <select [(ngModel)]="filterStatut" (change)="onFilterChange()"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-lg pl-4 pr-10 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors">
            <option value="actifs">Actifs (confirmé + restreint)</option>
            <option value="tous">Tous</option>
            <option value="confirmé">Confirmé</option>
            <option value="restreint">Restreint</option>
            <option value="email en attente">Email en attente</option>
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3">
            <i-lucide name="chevron-down" class="w-4 h-4 text-gray-500"></i-lucide>
          </div>
        </div>
      </div>

      <!-- Barre de recherche -->
      <div class="w-full sm:flex-1">
        <label class="block text-sm font-medium text-gray-600 mb-2">Rechercher</label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <i-lucide name="search" class="w-4 h-4 text-gray-400"></i-lucide>
          </div>
          <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange($event)"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-lg pl-10 pr-4 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors"
            placeholder="Rechercher par nom, prénom, email, téléphone..." />
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau avec design moderne - caché sur mobile -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hidden md:block">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-100">
        <thead>
          <tr class="bg-gray-50">
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('created_at')">
              <div class="flex items-center gap-2">
                <span>Inscription</span>
                <i-lucide [name]="getSortIcon('created_at')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('type')">
              <div class="flex items-center gap-2">
                <span>Type</span>
                <i-lucide [name]="getSortIcon('type')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('statut')">
              <div class="flex items-center gap-2">
                <span>Statut</span>
                <i-lucide [name]="getSortIcon('statut')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('nom')">
              <div class="flex items-center gap-2">
                <span>Nom</span>
                <i-lucide [name]="getSortIcon('nom')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('prenom')">
              <div class="flex items-center gap-2">
                <span>Prénom</span>
                <i-lucide [name]="getSortIcon('prenom')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('email')">
              <div class="flex items-center gap-2">
                <span>Email</span>
                <i-lucide [name]="getSortIcon('email')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('telephone')">
              <div class="flex items-center gap-2">
                <span>Téléphone</span>
                <i-lucide [name]="getSortIcon('telephone')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('ville')">
              <div class="flex items-center gap-2">
                <span>Ville</span>
                <i-lucide [name]="getSortIcon('ville')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('age')">
              <div class="flex items-center gap-2">
                <span>Âge</span>
                <i-lucide [name]="getSortIcon('age')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('genre')">
              <div class="flex items-center gap-2">
                <span>Genre</span>
                <i-lucide [name]="getSortIcon('genre')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" (click)="sortBy('date_derniere_action_presente')">
              <div class="flex items-center gap-2">
                <span>Dernière présence</span>
                <i-lucide [name]="getSortIcon('date_derniere_action_presente')" class="w-4 h-4"></i-lucide>
              </div>
            </th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-100">
          <!-- Loader avec animation -->
          <ng-container *ngIf="isLoading">
            <tr>
              <td colspan="11" class="px-6 py-16 text-center">
                <div class="flex justify-center">
                  <div class="animate-spin rounded-full h-12 w-12 border-4 border-[#ff7443]/20 border-t-[#ff7443]">
                  </div>
                </div>
                <p class="mt-4 text-sm text-gray-500">
                  <span *ngIf="isSearching">Recherche en cours...</span>
                  <span *ngIf="!isSearching">Chargement des données...</span>
                </p>
              </td>
            </tr>
          </ng-container>

          <!-- État vide -->
          <ng-container *ngIf="!isLoading && benevoles.length === 0">
            <tr>
              <td colspan="11" class="px-6 py-16 text-center">
                <div class="flex justify-center">
                  <div class="p-5 bg-[#fff8f6] rounded-full">
                    <i-lucide name="users" class="w-14 h-14 text-[#ff7443]"></i-lucide>
                  </div>
                </div>
                <h3 class="mt-4 text-lg font-medium text-gray-900">Aucun bénévole trouvé</h3>
                <p class="mt-2 text-sm text-gray-500 max-w-md mx-auto">
                  <span *ngIf="searchTerm">Aucun résultat ne correspond à votre recherche "{{ searchTerm }}"</span>
                  <span *ngIf="!searchTerm">Aucun bénévole enregistré pour le moment.</span>
                </p>
              </td>
            </tr>
          </ng-container>

          <!-- Données des bénévoles -->
          <ng-container *ngFor="let benevole of benevolesAffiches">
            <tr class="hover:bg-gray-50 transition-colors duration-150 cursor-pointer" (click)="openBenevoleDetail(benevole)">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">{{ benevole.created_at ? (benevole.created_at | date: 'dd/MM/yyyy') : '-' }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [ngClass]="{
                    'bg-blue-100 text-blue-800': benevole.type === 'bénévole',
                    'bg-purple-100 text-purple-800': benevole.type === 'responsable'
                  }">
                  {{ benevole.type }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                  [ngClass]="{
                    'bg-green-100 text-green-800': benevole.statut === 'confirmé',
                    'bg-orange-100 text-orange-800': benevole.statut === 'restreint',
                    'bg-yellow-100 text-yellow-800': benevole.statut === 'email en attente'
                  }">
                  {{ benevole.statut || 'Non renseigné' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ benevole.nom }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ benevole.prenom }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500 max-w-[180px] truncate" title="{{ benevole.email }}">{{ benevole.email }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ benevole.telephone }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">{{ benevole.ville }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ benevole.age }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500 capitalize">{{ benevole.genre }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">{{ benevole.date_derniere_action_presente ? (benevole.date_derniere_action_presente | date: 'dd/MM/yyyy') : '-' }}</div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Vue mobile en cartes -->
  <div class="md:hidden space-y-4">
    <!-- Loader mobile -->
    <div *ngIf="isLoading" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center">
      <div class="flex justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-[#ff7443]/20 border-t-[#ff7443]"></div>
      </div>
      <p class="mt-4 text-sm text-gray-500">
        <span *ngIf="isSearching">Recherche en cours...</span>
        <span *ngIf="!isSearching">Chargement des données...</span>
      </p>
    </div>

    <!-- État vide mobile -->
    <div *ngIf="!isLoading && benevoles.length === 0"
      class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center">
      <div class="flex justify-center">
        <div class="p-5 bg-[#fff8f6] rounded-full">
          <i-lucide name="users" class="w-12 h-12 text-[#ff7443]"></i-lucide>
        </div>
      </div>
      <h3 class="mt-4 text-lg font-medium text-gray-900">Aucun bénévole trouvé</h3>
      <p class="mt-2 text-sm text-gray-500">
        <span *ngIf="searchTerm">Aucun résultat ne correspond à votre recherche "{{ searchTerm }}"</span>
        <span *ngIf="!searchTerm">Aucun bénévole enregistré pour le moment.</span>
      </p>
    </div>

    <!-- Cartes de bénévoles pour mobile -->
    <div *ngFor="let benevole of benevolesAffiches"
      class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 overflow-hidden" (click)="openBenevoleDetail(benevole)">
      <div class="flex justify-between items-start mb-2">
        <div class="text-base font-medium text-gray-900">{{ benevole.nom }} {{ benevole.prenom }}</div>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
          {{ benevole.type }}
        </span>
      </div>
      <div class="text-sm text-gray-500 mb-2 truncate">{{ benevole.email }}</div>
      <div class="text-sm text-gray-500 mb-2">{{ benevole.telephone }}</div>
      <div class="flex justify-between text-sm text-gray-500 mb-2">
        <span>{{ benevole.ville }}</span>
        <span>{{ benevole.age }} ans - {{ benevole.genre }}</span>
      </div>
      <div class="flex justify-between text-xs text-gray-400 pt-2 border-t border-gray-100">
        <span>Inscrit : {{ benevole.created_at ? (benevole.created_at | date: 'dd/MM/yy') : '-' }}</span>
        <span>Dernier : {{ benevole.date_derniere_action_presente ? (benevole.date_derniere_action_presente | date: 'dd/MM/yy') : '-' }}</span>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 mt-4 px-6 py-4">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <div class="text-sm text-gray-500">
        Affichage <span class="font-medium text-gray-700">{{ ((pageActuelle - 1) * itemsParPage) + 1 }}</span> à
        <span class="font-medium text-gray-700">{{ Math.min(pageActuelle * itemsParPage, benevoles.length) }}</span>
        sur <span class="font-medium text-gray-700">{{ benevoles.length || 0 }}</span> bénévoles
      </div>

      <div class="flex items-center space-x-2">
        <button [disabled]="pageActuelle === 1" (click)="pagePrecedente()"
          class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-md text-sm font-medium bg-white transition-all"
          [ngClass]="{'opacity-50 cursor-not-allowed': pageActuelle === 1, 'hover:bg-gray-50 hover:border-gray-300': pageActuelle !== 1}">
          <i-lucide name="chevron-left" class="w-4 h-4 mr-1"></i-lucide>
          <span class="hidden sm:inline">Précédent</span>
        </button>

        <span class="px-3 py-1 bg-[#fff8f6] text-sm text-[#ff7443] rounded-md font-medium border border-[#ffece6]">
          {{ pageActuelle }} / {{ nombreTotalPages || 1 }}
        </span>

        <button [disabled]="pageActuelle === nombreTotalPages || nombreTotalPages === 0" (click)="pageSuivante()"
          class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-md text-sm font-medium bg-white transition-all"
          [ngClass]="{'opacity-50 cursor-not-allowed': pageActuelle === nombreTotalPages || nombreTotalPages === 0, 'hover:bg-gray-50 hover:border-gray-300': pageActuelle !== nombreTotalPages && nombreTotalPages !== 0}">
          <span class="hidden sm:inline">Suivant</span>
          <i-lucide name="chevron-right" class="w-4 h-4 ml-1"></i-lucide>
        </button>
      </div>
    </div>
  </div>
</div>
