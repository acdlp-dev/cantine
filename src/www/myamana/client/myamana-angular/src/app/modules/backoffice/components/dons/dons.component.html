<!-- Contenu principal -->
<div class="max-w-7xl mx-auto p-4 sm:p-6">
  <!-- En-tête avec bouton d'export -->
  <div class="max-w-7xl mx-auto p-4 sm:p-6 mt-8">
    <!-- En-tête avec bouton d'export -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 tracking-tight flex flex-wrap items-baseline gap-2">
        Tableau des <span class="text-[#ff7443]">dons</span>
  
      </h1>
  
    </div>

    <div class="flex space-x-2 dons-actions">
      <button (click)="exporterCSV()"
        class="flex items-center gap-2 bg-white px-4 py-2.5 rounded-lg text-sm text-gray-700 border border-gray-200 hover:border-[#ff7443] hover:bg-[#fff8f6] transition-all shadow-sm hover:shadow">
        <i-lucide name="file-text" class="w-4 h-4 text-[#ff7443]"></i-lucide>
        <span>Exporter en CSV</span>
      </button>
      
      <!-- Bouton de guide intégré -->
    </div>
  </div>

  <!-- Filtres et recherche -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 mb-6 dons-filter">
    <div class="flex flex-wrap gap-6 items-end">
      <!-- Filtre par année -->
      <div class="w-full sm:w-auto">
        <label class="block text-sm font-medium text-gray-600 mb-2">Année</label>
        <div class="relative">
          <select [(ngModel)]="filterYear" (change)="filtrerParAnnee(filterYear)"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-lg pl-4 pr-10 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors">
            <option value="toutes">Toutes</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3">
            <i-lucide name="chevron-down" class="w-4 h-4 text-gray-500"></i-lucide>
          </div>
        </div>
      </div>

      <!-- Barre de recherche -->
      <!-- Remplacez la section "Barre de recherche" qui se trouve vers la ligne 50 par celle-ci -->
      <div class="w-full sm:flex-1">
        <label class="block text-sm font-medium text-gray-600 mb-2">Rechercher</label>
        <div class="relative flex">
          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <i-lucide name="search" class="w-4 h-4 text-gray-400"></i-lucide>
          </div>
          <input type="text" [(ngModel)]="searchTerm"
            class="appearance-none w-full bg-gray-50 border border-gray-200 rounded-l-lg pl-10 py-2.5 text-gray-700 focus:outline-none focus:ring-2 focus:ring-[#ff7443]/20 focus:border-[#ff7443] transition-colors"
            placeholder="Rechercher" />
          <button (click)="searchDons(searchTerm)"
            class="bg-[#ff7443] text-white px-4 py-2.5 rounded-r-lg hover:bg-[#ff6234] focus:outline-none focus:ring-2 focus:ring-[#ff7443] transition-colors">
            Rechercher
          </button>
          <button *ngIf="searchTerm" (click)="searchTerm = ''; searchDons('')"
            class="absolute inset-y-0 right-24 flex items-center pr-3 cursor-pointer text-gray-400 hover:text-gray-600"
            title="Effacer la recherche">
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Tableau avec design moderne - caché sur mobile -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hidden md:block dons-list">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-100">
        <thead>
          <tr class="bg-gray-50">
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Date
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Email
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Nom
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Prénom
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Campagne
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Montant
            </th>
            <th scope="col" class="px-6 py-3.5 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Type
            </th>
            <th scope="col" class="px-6 py-3.5 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-100">
          <!-- Loader avec animation améliorée -->
          <ng-container *ngIf="isLoading">
            <tr>
              <td colspan="8" class="px-6 py-16 text-center">
                <div class="flex justify-center">
                  <div class="animate-spin rounded-full h-12 w-12 border-4 border-[#ff7443]/20 border-t-[#ff7443]">
                  </div>
                </div>
                <p class="mt-4 text-sm text-gray-500">
                  <span *ngIf="isSearching">Recherche en cours...</span>
                  <span *ngIf="!isSearching">Chargement des données...</span>
                </p>
              </td>
            </tr>
          </ng-container>

          <!-- État vide avec illustration -->
          <ng-container *ngIf="!isLoading && donsBackOffice.length === 0">
            <tr>
              <td colspan="8" class="px-6 py-16 text-center">
                <div class="flex justify-center">
                  <div class="p-5 bg-[#fff8f6] rounded-full">
                    <i-lucide name="heart-handshake" class="w-14 h-14 text-[#ff7443]"></i-lucide>
                  </div>
                </div>
                <h3 class="mt-4 text-lg font-medium text-gray-900">Aucun don trouvé</h3>
                <p class="mt-2 text-sm text-gray-500 max-w-md mx-auto">
                  <span *ngIf="searchTerm">Aucun résultat ne correspond à votre recherche "{{ searchTerm }}"</span>
                  <span *ngIf="!searchTerm">Aucun don ne correspond à vos critères de recherche pour cette
                    période.</span>
                </p>
              </td>
            </tr>
          </ng-container>

          <!-- Données des dons avec design amélioré -->
          <ng-container *ngFor="let don of donsAffiches; let i = index">
            <tr class="hover:bg-gray-50 transition-colors duration-150 cursor-pointer" (click)="showDonDetail(don.id)">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900 font-medium">{{ don.datePaiement }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500 max-w-[180px] truncate" title="{{ don.email }}">{{ don.email }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ don.nom }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ don.prenom }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500 max-w-[160px] truncate" title="{{ don.amana }}">{{ don.amana }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-semibold text-[#ff7443]">{{ don.montant }} €</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" [ngClass]="{
                  'bg-green-100 text-green-800': don.type === 'mensuel',
                  'bg-blue-100 text-blue-800': don.type === 'ponctuel',
                  'bg-purple-100 text-purple-800': don.type === 'quotidien',
                  'bg-amber-100 text-amber-800': don.type !== 'mensuel' && don.type !== 'ponctuel'
                }">
                  <span class="w-1.5 h-1.5 mr-1.5 rounded-full" [ngClass]="{
                    'bg-green-500': don.type === 'mensuel',
                    'bg-blue-500': don.type === 'ponctuel',
                    'bg-purple-500': don.type === 'quotidien',
                    'bg-amber-500': don.type === 'autre'
                  }"></span>
                  {{ don.type }}
                </span>
              </td>
              <!-- Modifier la partie "Actions" du tableau -->
              <td class="px-6 py-4 text-right whitespace-nowrap">
                <button (click)="showDonDetail(don.id)"
                  class="inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-[#ff7443] hover:bg-[#fff8f6] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#ff7443]/50 transition-colors">
                  <i-lucide name="eye" class="w-3.5 h-3.5 mr-1"></i-lucide>
                  Détails
                </button>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Vue mobile en cartes empilées -->
  <div class="md:hidden space-y-4">
    <!-- Loader mobile -->
    <div *ngIf="isLoading" class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center">
      <div class="flex justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-[#ff7443]/20 border-t-[#ff7443]"></div>
      </div>
      <p class="mt-4 text-sm text-gray-500">
        <span *ngIf="isSearching">Recherche en cours...</span>
        <span *ngIf="!isSearching">Chargement des données...</span>
      </p>
    </div>

    <!-- État vide mobile -->
    <div *ngIf="!isLoading && donsBackOffice.length === 0"
      class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center">
      <div class="flex justify-center">
        <div class="p-5 bg-[#fff8f6] rounded-full">
          <i-lucide name="heart-handshake" class="w-12 h-12 text-[#ff7443]"></i-lucide>
        </div>
      </div>
      <h3 class="mt-4 text-lg font-medium text-gray-900">Aucun don trouvé</h3>
      <p class="mt-2 text-sm text-gray-500">
        <span *ngIf="searchTerm">Aucun résultat ne correspond à votre recherche "{{ searchTerm }}"</span>
        <span *ngIf="!searchTerm">Aucun don ne correspond à vos critères de recherche pour cette période.</span>
      </p>
    </div>

    <!-- Cartes de dons pour mobile -->
    <div *ngFor="let don of donsAffiches"
      class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 overflow-hidden">
      <div class="flex justify-between items-start mb-2">
        <div class="text-sm font-medium text-gray-900">{{ don.datePaiement }}</div>
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" [ngClass]="{
          'bg-green-100 text-green-800': don.type === 'mensuel',
          'bg-blue-100 text-blue-800': don.type === 'ponctuel',
          'bg-amber-100 text-amber-800': don.type === 'autre'
        }">
          <span class="w-1.5 h-1.5 mr-1.5 rounded-full" [ngClass]="{
            'bg-green-500': don.type === 'mensuel',
            'bg-blue-500': don.type === 'ponctuel',
            'bg-amber-500': don.type === 'autre'
          }"></span>
          {{ don.type }}
        </span>
      </div>
      <div class="flex justify-between items-center mb-2">
        <div class="text-base font-medium text-gray-900">{{ don.nom }} {{ don.prenom }}</div>
        <div class="text-base font-semibold text-[#ff7443]">{{ don.montant }} €</div>
      </div>
      <div class="text-sm text-gray-500 mb-2 truncate">{{ don.email }}</div>
      <div class="text-sm text-gray-500 mb-4">{{ don.amana }}</div>

      <div class="flex justify-end">
        <button
          class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-md text-sm font-medium text-[#ff7443] hover:bg-[#fff8f6] transition-all">
          <i-lucide name="eye" class="w-4 h-4 mr-2"></i-lucide>
          Détails
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination redesignée - applicable aux deux vues -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 mt-4 px-6 py-4">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
      <div class="text-sm text-gray-500">
        Affichage <span class="font-medium text-gray-700">{{ ((pageActuelle - 1) * itemsParPage) + 1 }}</span> à
        <span class="font-medium text-gray-700">{{ Math.min(pageActuelle * itemsParPage, donsBackOffice.length)
          }}</span>
        sur <span class="font-medium text-gray-700">{{ donsBackOffice.length || 0 }}</span> dons
      </div>

      <div class="flex items-center space-x-2">
        <button [disabled]="pageActuelle === 1" (click)="pagePrecedente()"
          class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-md text-sm font-medium bg-white transition-all"
          [ngClass]="{'opacity-50 cursor-not-allowed': pageActuelle === 1, 'hover:bg-gray-50 hover:border-gray-300': pageActuelle !== 1}">
          <i-lucide name="chevron-left" class="w-4 h-4 mr-1"></i-lucide>
          <span class="hidden sm:inline">Précédent</span>
        </button>

        <!-- Indicateur de page actuelle -->
        <span class="px-3 py-1 bg-[#fff8f6] text-sm text-[#ff7443] rounded-md font-medium border border-[#ffece6]">
          {{ pageActuelle }} / {{ nombreTotalPages || 1 }}
        </span>

        <button [disabled]="pageActuelle === nombreTotalPages || nombreTotalPages === 0" (click)="pageSuivante()"
          class="inline-flex items-center px-3 py-2 border border-gray-200 rounded-md text-sm font-medium bg-white transition-all"
          [ngClass]="{'opacity-50 cursor-not-allowed': pageActuelle === nombreTotalPages || nombreTotalPages === 0, 'hover:bg-gray-50 hover:border-gray-300': pageActuelle !== nombreTotalPages && nombreTotalPages !== 0}">
          <span class="hidden sm:inline">Suivant</span>
          <i-lucide name="chevron-right" class="w-4 h-4 ml-1"></i-lucide>
        </button>
      </div>
    </div>
  </div>
</div>