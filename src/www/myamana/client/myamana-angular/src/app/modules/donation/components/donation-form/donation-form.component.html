<form [formGroup]="donationDetailsForm" (ngSubmit)="onSubmit()" class="space-y-6">
  <div>
    <select formControlName="campaign" class="input-field" (change)="updateSelectedCampaignStep()">
      @for (campaign of campaigns; track campaign.nom) {
      @if (campaign.statut === 'actif') {
      <option [value]="campaign.nom">{{ campaign.nom }}</option>
      }
      }
    </select>
  </div>
  @if (showError('campaign')) {
  <p class="text-red-500 text-sm">Veuillez renseigner ce champs</p>
  }
  @if(checkIfUnknownCampaign()){
  <p class="text-red-500 text-sm">Cette campagne n'est pas disponible, veuillez en s√©l√©ctionner une dans la liste.</p>
  }

  <!-- üîΩ Affichage conditionnel selon step1 üîΩ -->
  <div *ngIf="selectedCampaignStep === CampaignType.LIBRE">
    <div class="relative">
      <input type="number" formControlName="amount" [class]="'input-field ' + (showError('amount') ? 'error' : '')"
        placeholder="Montant" min="1" step="1" (keypress)="onAmountKeyPress($event)" 
        (input)="updateDonationAmount()" (change)="updateDonationAmount()" />
      <span class="absolute right-8 top-1/2 transform -translate-y-1/2">‚Ç¨</span>
    </div>
    @if (showError('amount')) {
    <p class="text-red-500 text-sm">Ce champ est requis. Le montant doit √™tre sup√©rieur √† 1‚Ç¨</p>
    }
  </div> 

  <div *ngIf="selectedCampaignStep === CampaignType.CALCUL">
    <input 
      type="number" 
      formControlName="paymentDaysToCatchUp"
      [class]="'input-field ' + (showError('paymentDaysToCatchUp') ? 'error' : '')"
      placeholder="Nombre de jours √† rattraper" 
      min="1"
      (input)="updateDonationAmount()" 
      (change)="updateDonationAmount()"
    />
    @if (showError('paymentDaysToCatchUp')) {
    <p class="text-red-500 text-sm">Ce champ est requis. Veuillez indiquer un nombre de jours valide</p>
    }
  </div>

  <div *ngIf="selectedCampaignStep === CampaignType.SELECTEUR_NOMINATIF">
    <div *ngFor="let tree of trees.controls; let i = index" class="flex space-x-2 items-center">
      <input [formControl]="getTreeNameControl(i)" 
             [class]="'input-field tree-input ' + (showError('trees') && !getTreeNameControl(i).value ? 'error' : '')" 
             placeholder="Nom de l'arbre">

    <!-- Bouton supprimer -->
    <button *ngIf="trees.length > 1" type="button" (click)="removeTree(i)" class="bg-red-500 text-white px-3 h-10 flex items-center justify-center rounded hover:bg-red-700">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
      </svg>
    </button>

      <!-- Bouton pour ajouter un nouvel arbre -->
      <button type="button" class="bg-red-500 text-white px-3 h-10 flex items-center justify-center rounded hover:bg-red-700" (click)="addTree()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    
    @if (showError('trees')) {
    <p class="text-red-500 text-sm">Ce champ est requis. Veuillez nommer tous les arbres</p>
    }
  </div>

   

  <div *ngIf="isMonthly">
    <p class="text-sm text-gray-700">
      Vous serez pr√©lev√© le 
      <input 
        type="number" 
        class="input-field w-16 text-center" 
        formControlName="paymentDay"
        min="1"
        max="28"
      /> 
      du mois.
    </p>  
    <p *ngIf="showError('paymentDay')" class="text-red-500 text-sm">
      Veuillez entrer un jour valide entre 1 et 28.
    </p>
  </div>



  <div *ngIf="showTaxReduction" class="text-center text-sm text-gray-600">
    Votre don ne vous co√ªtera potentiellement que {{ donationAmount !== null && donationAmount !== undefined ? (donationAmount * 0.25) : '...' }}
    Euros apr√®s r√©duction fiscale sous
    <a href="https://www.economie.gouv.fr/particuliers/prelevement-a-la-source-reductions-fiscales-dons-associations#:~:text=Les%20dons%20au%20profit%20des,du%20pr%C3%A9l%C3%A8vement%20%C3%A0%20la%20source"
      target="_blank" class="text-donation hover:underline">
      conditions
    </a>
  </div>

  <div *ngIf="selectedCampaignStep === CampaignType.LIBRE" class="flex space-x-4 justify-center">
    @for (amount of predefinedAmounts; track amount) {
    <button type="button" (click)="setAmount(amount)" class="btn-donation">
      {{ amount }}‚Ç¨
    </button>
    }
  </div>

 

  <div class="text-center">
    <button type="submit" class="btn-donation">
      SUIVANT
    </button>
  </div>
</form>
